# 03장 역할,책임,협력

# 0. 들어가며

객체지향 패러다임의 핵심은 역할,책임,협력이다.

흔히, 클래스, 상속, 지연 바인딩이 객체 지향의 핵심이라고 생각하지만, 이들은 구현 측면에 치우쳐 있어 객체 지향 패러다임과의 본질과는 거리가 멀다.

객체 지향의 본질?

- 협력하는 객체들의 공동체를 창조하는 것이다.

본 장에서는 응집도가 높고 객체간 종속성이 낮은 애플리케이션을 설계하는데 핵심인 역할,책임,협력에 대해 알아보는 시간을 가진다.

---

# 1. 협력

### 1-1. 협력은 객체간 의사소통이다.

**협력이란?**

객체간 기능을 구현하기 위해 이루어지는 상호작용이다.

영화 예매 기능을 완성하기 위해 객체간 협력하는 구조를 나타내면 아래와 같다.

![image](https://github.com/user-attachments/assets/e622e3c6-4281-42a4-818c-c8fce758ec2f)

영화 예매라는 문맥 아래에서 여러 객체들 간 서로 소통하는 점을 확인해 볼 수 있다.

객체 간 서로 필요한 기능을 요청하는 유일한 수단은 **메시지 전송**이며,

각 객체들은 협력을 수행하기 위해 **역할**을 가지고 있다.

### 1-2. 협력은 문맥을 제공한다.

위 다이어그램에서 역할 수행을 요청하는 메시지는 아래와 같다.

![image 1](https://github.com/user-attachments/assets/a39357e6-059f-4ade-91ec-80cf0571055b)

요금을 계산하기 위해 Screening이 Movie에게 메시지를 전달하고 있다. Movie가 요금을 계산하는데 필요한 조건들을 알고 있기 때문이다.

이로부터 Movie가 자율적인 객체임을 알 수 있으며, 그 이유는 다음과 같다.

- 요금 계산 메시지를 응답하는 책임을 가진다.
- Screening은 요금을 계산하는데 필요한 정보들을 알지 못하기에, Movie에게 요금 계산을 요청한다.

여기서 **Movie의 상태는 미리 결정되지 않으며, 책임을 수행할 행동에 의해 결정**된다.

그리고 **Movie의 행동을 결정하는 것은** Movie가 참여하고 있는 **협력**이다.

정리하면 아래와 같다.

- 상태는 객체가 행동하는 데 필요한 정보에 의해 결정된다.
- 행동은 협력 안에서 객체가 처리할 메시지로 결정된다.

⇒ 협력은 객체를 설계하는 데 필요한 일종의 문맥(context)를 제공한다.

---

# 2. 책임

### 2-1. 책임은 협력이 정한다.

**책임이란?**

협력에 참여하기 위해 객체가 수행하는 행동이다.

영화 예매 시스템을 구성하는 책임을 CRC 카드로 정리하면 아래와 같다.

![image 2](https://github.com/user-attachments/assets/0e3029b3-f25d-49ba-a9b5-f5394b5e333f)

영화 예매 시스템의 객체간 협력에서 각 객체에게 필요한 책임은 아래와 같이 볼 수 있다.

- Screening : 예매 정보를 생성한다.
- Movie : 가격을 계산한다.
- DiscountPolicy : 할인된 가격을 계산한다.
- DiscountCondition : 할인 여부를 판단한다.

여기서 책임을 결정하는 문맥은 협력이 결정한다는 점을 알 수 있다.

### 2-2. 문맥에서의 책임 할당

객체에게 책임을 할당하기 위해서는 먼저 협력이라는 문맥을 정의해야 하는데, 영화 예매 어플리케이션에서는 아래와 같다.

먼저, “예매하라”는 문맥이 가장 우선한다.

![image 3](https://github.com/user-attachments/assets/3d4cbe00-7607-4ff9-98ca-33e433bca08e)

영화 예매와 관련된 정보를 **가장 많이 알고 있는 객체에게 책임을 할당**한다.

![image 4](https://github.com/user-attachments/assets/2d08848b-5530-438c-bd01-a0515e7f2b33)

Screening은 예매 가격을 계산하는데 충분한 정보를 가지고 있지 않다.

외부 객체에게 가격 계산 메시지를 요청한다.

![image 5](https://github.com/user-attachments/assets/f2a641f9-df4e-4b87-9ac2-79c881cd1d12)

이처럼 객체지향 설계는 협력에 필요한 메시지를 찾고 메시지에 적절한 객체를 선택하는 반복적인 과정을 통해 이뤄진다.

위 과정에서 눈여겨볼 것은 객체가 메시지를 선택하는 것이 아니라 메시지가 객체를 선택하게 했다는 점이다.

이렇게 함으로써 객체가 충분히 추상적면서 미니멀리즘을 따르는 인터페이스를 가질 수 있게된다.

- **인터페이스가 무엇(what)을 하는지만 표현하고, 어떻게(how) 수행하는지를 노출하지 않는다.**

---

# 3. 역할

### 3-1. 책임의 집합, 협력

**역할이란?**

객체가 어떤 특정한 협력 안에서 수행하는 책임의 집합이다.

역할이 중요한 이유는 **역할을 통해 유연하고 재사용 가능한 협력을 얻을 수 있기 때문**이다.

요금 할인 정책을 알기 위한 메시지 요청 과정은 아래와 같다.

![image 6](https://github.com/user-attachments/assets/72e9a2c9-7ce2-4031-b496-1f284502b4f8)

영화 요금 할인 정책은 여러가지로 존재할 수 있다. (본 서적에서는 금액/비율 할인 정책)

매 할인 정책 케이스마다 협력을 만들어내야 한다면 코드의 중복이 다수 발생하게 될 것이다.

객체가 아닌 협력에 초점을 맞추면 이 문제를 해결할 수 있다.

- 금액/비율 할인 정책은 **“할인 요금 계산”이라는 공통된 책임**이 있다.

두 종류의 객체를 포괄하는 추상화를 적용하면 아래와 같이 표현될 수 있다.

![image 7](https://github.com/user-attachments/assets/6956903b-3070-43c6-9b8e-26a610b9b414)

요점은 **동일한 책임을 수행하는 역할을 기반**으로 **두 개의 협력을 하나로 통합**할 수 있다는 것이다.

### 3-2. 언제 역할을 정의할까

협력에 참여하는 후보가 단 한 종류의 객체라면 역할을 정의할 필요는 없다.

저자는 설계 초반에는 역할과 객체를 명확하게 구분하는 것은 중요하지 않다고 전하고 있다.

**중요한 것은 객체가 협력이라는 문맥에서 수행할 책임을 정의하는 것**인데, 협력에 참여할 후보가 여러 객체로 바뀐다면 그때 역할을 고려해도 늦지 않다.

영화 예매 어플리케이션 예제는 할인 요금 계산/할인 여부 판단 협력에 참여할 후보가 여러 객체이기에

공통 책임(역할)을 추상화 할 수 있다.

![image 8](https://github.com/user-attachments/assets/4e9393f8-3c74-4536-bb32-4f0e08e99bd7)

협력에서 추상화의 장점은 아래와 같다.

1. 세부 사항에 억눌리지 않고도 **상위 수준의 정책을 쉽고 간단하게 표현**할 수 있다.
- 여러 구현체에서 사용될 세부 사항을 몰라도 메시지의 의도만 이해한다면 협력에 문제가 없다.

이를 표현하면 아래와 같다.

![image 9](https://github.com/user-attachments/assets/f5a994e4-304a-4e88-b5b6-004cec9a6c56)

- 할인 조건을 만족하는지 판단하는데 필요한 세부 사항을 몰라도 메시지 만을 통해 협력을 수행할 수 있다.

1. 설계를 유연하게 만들 수 있다.
- 협력 안에서 동일한 책임을 수행하는 객체들은 동일한 역할을 수행하기 때문에 서로 대체 가능하다.

---

# 4. 마무리하며

이 장의 핵심을 요약하면 아래와 같다.

1. 객체 지향 설계는 객체로 중심으로 시작하지 않고, 협력을 중심으로 시작된다.
2. 협력은 책임을 결정하고, 책임은 역할을 만들며, 역할은 유연하고 확장 가능한 구조를 가능하게 한다.
3. 좋은 객체 지향은 ‘객체’가 아니라 ‘협력’을 설계하는 것이다.

감사합니다.
